(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{397:function(e,s,t){"use strict";t.r(s);var a=t(4),r=Object(a.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"sequelize"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sequelize"}},[e._v("#")]),e._v(" Sequelize")]),e._v(" "),s("h3",{attrs:{id:"sequelize-cli"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sequelize-cli"}},[e._v("#")]),e._v(" sequelize-cli")]),e._v(" "),s("p",[s("strong",[e._v("需要")]),e._v(" "),s("a",{attrs:{href:"http://docs.sequelizejs.com/manual/tutorial/migrations.html",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[e._v("Migrations")]),s("OutboundLink")],1),e._v(" "),s("strong",[e._v("来帮我们管理数据结构的变更")]),e._v("(在项目的演进过程中，每一个迭代都有可能对数据库数据结构做变更，怎样跟踪每一个迭代的数据变更，并在不同的环境（开发、测试、CI）和迭代切换中，快速变更数据结构呢？)")]),e._v(" "),s("p",[e._v("sequelize 提供了 "),s("a",{attrs:{href:"https://github.com/sequelize/cli",target:"_blank",rel:"noopener noreferrer"}},[e._v("sequelize-cli"),s("OutboundLink")],1),e._v(" 工具来实现 "),s("a",{attrs:{href:"http://docs.sequelizejs.com/manual/tutorial/migrations.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Migrations"),s("OutboundLink")],1)]),e._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[e._v("sequelize "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("command"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("Commands")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("\n  sequelize db"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("migrate                        Run pending migrations\n  sequelize db"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("migrate"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("schema"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("timestamps"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("add  Update migration table to have timestamps\n  sequelize db"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("migrate"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("status                 List the status "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("of")]),e._v(" all migrations\n  sequelize db"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("migrate"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("undo                   Reverts a migration\n  sequelize db"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("migrate"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("undo"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("all               Revert all migrations ran\n  sequelize db"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("seed                           Run specified seeder\n  sequelize db"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("seed"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("undo                      Deletes data from the database\n  sequelize db"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("seed"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("all                       Run every seeder\n  sequelize db"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("seed"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("undo"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("all                  Deletes data from the database\n  sequelize db"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("create                         Create database specified by configuration\n  sequelize db"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("drop                           Drop database specified by configuration\n  sequelize init                              Initializes project\n  sequelize init"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("config                       Initializes configuration\n  sequelize init"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("migrations                   Initializes migrations\n  sequelize init"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("models                       Initializes models\n  sequelize init"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("seeders                      Initializes seeders\n  sequelize migration"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("generate                Generates a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("migration")]),e._v(" file      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("aliases"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" migration"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("create"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n  sequelize model"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("generate                    Generates a model and its migration "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("aliases"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" model"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("create"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n  sequelize seed"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("generate                     Generates a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("seed")]),e._v(" file           "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("aliases"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" seed"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("create"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("Options")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("--")]),e._v("version  Show version number                                                  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("boolean"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("--")]),e._v("help     Show help                                                            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("boolean"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n\nPlease specify a command\n# 升级数据库\nnpx sequelize db"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("migrate\n# 如果有问题需要回滚，可以通过 "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[e._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("db:migrate:undo")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[e._v("`")])]),e._v(" 回退一个变更\n# npx sequelize db"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("migrate"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("undo\n# 可以通过 "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[e._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("db:migrate:undo:all")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[e._v("`")])]),e._v(" 回退到初始状态\n# npx sequelize db"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("migrate"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("undo"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("all\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br"),s("span",{staticClass:"line-number"},[e._v("27")]),s("br"),s("span",{staticClass:"line-number"},[e._v("28")]),s("br"),s("span",{staticClass:"line-number"},[e._v("29")]),s("br"),s("span",{staticClass:"line-number"},[e._v("30")]),s("br"),s("span",{staticClass:"line-number"},[e._v("31")]),s("br"),s("span",{staticClass:"line-number"},[e._v("32")]),s("br"),s("span",{staticClass:"line-number"},[e._v("33")]),s("br"),s("span",{staticClass:"line-number"},[e._v("34")]),s("br")])]),s("h2",{attrs:{id:"错误处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#错误处理"}},[e._v("#")]),e._v(" 错误处理")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("2020-10-23 15:20:10,104 "),s("strong",[e._v("ERROR")]),e._v(" 124768 [-/127.0.0.1/-/8ms POST /api/v1/video] nodejs.SequelizeDatabaseError: Incorrect string value: '\\xE5\\x8F\\x8D\\xE5\\xAF\\xB9...' for column 'introduce' at row 1")]),e._v(" "),s("p",[s("em",[e._v("at Query.formatError (D:\\Code\\Work\\wxwl-resource-share\\node_modules_sequelize@6.3.5@sequelize\\lib\\dialects\\mysql\\query.js:239:16)")])]),e._v(" "),s("p",[s("em",[e._v("at Query.run (D:\\Code\\Work\\wxwl-resource-share\\node_modules_sequelize@6.3.5@sequelize\\lib\\dialects\\mysql\\query.js:54:18)")])]),e._v(" "),s("p",[s("em",[e._v("at processTicksAndRejections (internal/process/task_queues.js:97:5)")])])])]),e._v(" "),s("p",[e._v('name: "SequelizeDatabaseError"')]),e._v(" "),s("p",[e._v('parent: {"code":"ER_TRUNCATED_WRONG_VALUE_FOR_FIELD","errno":1366,"sqlState":"HY000","sqlMessage":"Incorrect string value: \'\\xE5\\x8F\\x8D\\xE5\\xAF\\xB9...\' for column \'introduce\' at row 1","sql":"INSERT INTO '),s("code",[e._v("videos")]),e._v(" ("),s("code",[e._v("id")]),e._v(","),s("code",[e._v("category_id")]),e._v(","),s("code",[e._v("title")]),e._v(","),s("code",[e._v("introduce")]),e._v(","),s("code",[e._v("detail")]),e._v(","),s("code",[e._v("create_date")]),e._v(') VALUES (DEFAULT,?,?,?,?,?);","parameters":[1,"test11","tess反对t","231231","2020-10-23 07:20:10"]}')]),e._v(" "),s("p",[e._v('original: {"code":"ER_TRUNCATED_WRONG_VALUE_FOR_FIELD","errno":1366,"sqlState":"HY000","sqlMessage":"Incorrect string value: \'\\xE5\\x8F\\x8D\\xE5\\xAF\\xB9...\' for column \'introduce\' at row 1","sql":"INSERT INTO '),s("code",[e._v("videos")]),e._v(" ("),s("code",[e._v("id")]),e._v(","),s("code",[e._v("category_id")]),e._v(","),s("code",[e._v("title")]),e._v(","),s("code",[e._v("introduce")]),e._v(","),s("code",[e._v("detail")]),e._v(","),s("code",[e._v("create_date")]),e._v(') VALUES (DEFAULT,?,?,?,?,?);","parameters":[1,"test11","tess反对t","231231","2020-10-23 07:20:10"]}')]),e._v(" "),s("p",[e._v('sql: "INSERT INTO '),s("code",[e._v("videos")]),e._v(" ("),s("code",[e._v("id")]),e._v(","),s("code",[e._v("category_id")]),e._v(","),s("code",[e._v("title")]),e._v(","),s("code",[e._v("introduce")]),e._v(","),s("code",[e._v("detail")]),e._v(","),s("code",[e._v("create_date")]),e._v(') VALUES (DEFAULT,?,?,?,?,?);"')]),e._v(" "),s("p",[e._v('parameters: [1,"test11","tess反对t","231231","2020-10-23 07:20:10"]')]),e._v(" "),s("p",[e._v("pid: 124768")]),e._v(" "),s("p",[e._v("hostname: DESKTOP-FUCU627")])])}),[],!1,null,null,null);s.default=r.exports}}]);