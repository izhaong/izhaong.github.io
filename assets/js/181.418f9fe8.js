(window.webpackJsonp=window.webpackJsonp||[]).push([[181],{520:function(s,a,t){"use strict";t.r(a);var e=t(4),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"服务器准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器准备工作"}},[s._v("#")]),s._v(" 服务器准备工作")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("centos 7")])]),s._v(" "),a("li",[a("p",[s._v("docker")])]),s._v(" "),a("li",[a("p",[s._v("docker-compose")])]),s._v(" "),a("li",[a("p",[s._v("暂时关闭防火墙")])])]),s._v(" "),a("p",[a("em",[s._v("部署过程中遇到的问题我也在最后的目录中记录下来了  感谢东哥解惑")])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"安装postgresql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装postgresql"}},[s._v("#")]),s._v(" 安装postgresql")]),s._v(" "),a("ul",[a("li",[s._v("创建"),a("code",[s._v("/opt/docker/docker-compose.yml")]),s._v(" 文件")])]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[s._v("version: '3.5'\nservices:\n  timescaledb:\n    image: timescale/timescaledb:1.7.1-pg12\n    container_name: basic-timescaledb\n    restart: unless-stopped\n    ports:\n      - 5432:5432\n    environment:\n      POSTGRES_PASSWORD: *****\n    volumes:\n      - ./data:/var/lib/postgresql/data\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("跑一下 "),a("code",[s._v("docker-compose up")])])]),s._v(" "),a("li",[a("ul",[a("li",[s._v("如果 容器运行起来了 就可以用 Navicat Premium 连接一下")]),s._v(" "),a("li",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/izhaong/izhaong.com-oss/blogImg/020150.%E5%BC%80%E6%BA%90%E7%9A%84%E7%89%A9%E8%81%94%E7%BD%91%E5%B9%B3%E5%8F%B0thingsboard%E9%83%A8%E7%BD%B2/2021/12/30/13-37-14-16bba435c77c4040c6f6b65bbb1f5144-1602302360856-197da256-9c6d-40bc-ada2-c52778bf980c-0eab20.png",alt:"img"}})])])]),s._v(" "),a("li",[a("ul",[a("li",[s._v("连接成功后创建数据库 "),a("code",[s._v("thingsboard")]),s._v("(名字随便起)")])])])]),s._v(" "),a("h3",{attrs:{id:"为-docker配置远程连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为-docker配置远程连接"}},[s._v("#")]),s._v(" 为 docker配置远程连接")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("(https://blog.csdn.net/po__oq/article/details/106229575)")])]),s._v(" "),a("li",[a("ul",[a("li",[s._v("通过"),a("code",[s._v("daemon.json")]),s._v("配置")])])])]),s._v(" "),a("p",[s._v("编辑"),a("code",[s._v("/etc/docker/daemon.json")])]),s._v(" "),a("div",{staticClass:"language-plain line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plain"}},[a("code",[s._v('{\n\t"hosts": ["unix:///var/run/docker.sock", "tcp://0.0.0.0:2375"]\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("strong",[s._v("或者")])]),s._v(" "),a("ul",[a("li",[a("ul",[a("li",[s._v("通过systemd配置文件")])])])]),s._v(" "),a("p",[s._v("创建配置文件"),a("code",[s._v("/etc/systemd/system/docker.service.d/docker.conf")])]),s._v(" "),a("div",{staticClass:"language-plain line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plain"}},[a("code",[s._v("[Service]\nExecStart=\nExecStart=/usr/bin/dockerd -H fd:// -H tcp://127.0.0.1:2375\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[a("ul",[a("li",[s._v("保存文件"),a("code",[s._v("sudo systemctl daemon-reload")])]),s._v(" "),a("li",[s._v("重启docker"),a("code",[s._v("sudo systemctl restart docker.service")])])])]),s._v(" "),a("li",[a("ul",[a("li",[s._v("查看是否开启端口"),a("code",[s._v("sudo netstat -lntp | grep dockerd")])])])])]),s._v(" "),a("div",{staticClass:"language-plain line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plain"}},[a("code",[s._v("tcp        0      0 127.0.0.1:2375          0.0.0.0:*               LISTEN      3758/dockerd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[a("ul",[a("li",[s._v("docker cli 测试"),a("code",[s._v("docker -H :2375 ps")])])])])]),s._v(" "),a("div",{staticClass:"language-plain line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plain"}},[a("code",[s._v("CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"本地准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本地准备工作"}},[s._v("#")]),s._v(" 本地准备工作")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("仓库地址 https://github.com/thingsboard/thingsboard.git (3.1.1)")])]),s._v(" "),a("li",[a("p",[s._v("编辑器IDE https://www.jetbrains.com/zh-cn/idea/ (2020.1)")])]),s._v(" "),a("li",[a("p",[s._v("Java环境 jdk1.8")])]),s._v(" "),a("li",[a("p",[s._v("Navicat Premium")])])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"导入项目文件夹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导入项目文件夹"}},[s._v("#")]),s._v(" 导入项目文件夹")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("若代码显示飘红有错误提示 建议安装插件 **Lombok (**https://juejin.im/post/6844903557016076302)")])]),s._v(" "),a("li",[a("ul",[a("li",[s._v("*Lombok是一款好用顺手的工具，就像Google Guava一样，在此予以强烈推荐，每一个Java工程师都应该使用它。"),a("em",[a("em",[a("strong",[s._v("Lombok是一种Java™实用工具，可用来帮助开发人员消除Java的冗长代码，尤其是对于简单的Java对象（POJO）。它通过注释实现这一目的*")])]),s._v("。通过在开发环境中实现Lombok，开发人员可以节省构建诸如hashCode()和equals()这样的方法以及以往用来分类各种accessor和mutator的大量时间。")])])])])]),s._v(" "),a("h3",{attrs:{id:"修改数据库地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改数据库地址"}},[s._v("#")]),s._v(" 修改数据库地址")]),s._v(" "),a("ul",[a("li",[a("ul",[a("li",[s._v("打开文件"),a("code",[s._v("application/src/main/resources")])])])])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("# "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SQL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DAO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Configuration")]),s._v("\nspring"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  datasource"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    driverClassName"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"${SPRING_DRIVER_CLASS_NAME:org.postgresql.Driver}"')]),s._v("\n    url"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"${SPRING_DATASOURCE_URL:jdbc:postgresql://192.168.9.30:5432/thingsboard}"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// thingsboard名字与数据库名字一致")]),s._v("\n    username"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"${SPRING_DATASOURCE_USERNAME:postgres}"')]),s._v("\n    password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"${SPRING_DATASOURCE_PASSWORD:******}"')]),s._v("\n    hikari"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      maximumPoolSize"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"${SPRING_DATASOURCE_MAXIMUM_POOL_SIZE:16}"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"安装打个包看一下"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装打个包看一下"}},[s._v("#")]),s._v(" 安装打个包看一下")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/izhaong/izhaong/Blog/izhaong.com-localFile/020150.%E5%BC%80%E6%BA%90%E7%9A%84%E7%89%A9%E8%81%94%E7%BD%91%E5%B9%B3%E5%8F%B0thingsboard%E9%83%A8%E7%BD%B2/1602301728641-39a66288-e16f-41e7-a4c9-f0554a271e85.png",alt:"img"}})]),s._v(" "),a("p",[a("strong",[s._v("......(时间比较久, 我们就先处理下服务器)")])]),s._v(" "),a("hr"),s._v(" "),a("hr"),s._v(" "),a("p",[a("em",[s._v("这时我们回来再看本地项目")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/izhaong/izhaong/Blog/izhaong.com-localFile/020150.%E5%BC%80%E6%BA%90%E7%9A%84%E7%89%A9%E8%81%94%E7%BD%91%E5%B9%B3%E5%8F%B0thingsboard%E9%83%A8%E7%BD%B2/1602308563236-b98e2f80-8494-42dd-b75a-92fd49389511.png",alt:"img"}})]),s._v(" "),a("h3",{attrs:{id:"运行server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行server"}},[s._v("#")]),s._v(" 运行server")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("*application/src/main/java/org.thingsboard.server/ThingsbaordServerApplication*\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("em",[s._v("若出现错误")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/izhaong/izhaong/Blog/izhaong.com-localFile/020150.%E5%BC%80%E6%BA%90%E7%9A%84%E7%89%A9%E8%81%94%E7%BD%91%E5%B9%B3%E5%8F%B0thingsboard%E9%83%A8%E7%BD%B2/1602308679076-6510a399-5a15-4fe9-8e57-20b3d056a398.png",alt:"img"}})]),s._v(" "),a("p",[s._v("修改项目下 "),a("code",[s._v(".idea\\workspace.xml")]),s._v("，找到标签 "),a("code",[s._v('<component name="PropertiesComponent">')]),s._v(" ， 在标签里加一行 "),a("code",[s._v('<property name="dynamic.classpath" value="true" />')]),s._v("重新再跑下")]),s._v(" "),a("p",[s._v("在本地浏览器中打开: http://localhost:8080/ 显示登录页面表示你已经成功在本地跑起来了")]),s._v(" "),a("p",[a("em",[s._v("接下来就是放在服务器上")])]),s._v(" "),a("h3",{attrs:{id:"连接远程docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#连接远程docker"}},[s._v("#")]),s._v(" 连接远程docker")]),s._v(" "),a("p",[a("em",[s._v("前面做了服务端docker具备远程连接的工作, 现在在本地配置并连接")])]),s._v(" "),a("ul",[a("li",[s._v("配置")])]),s._v(" "),a("p",[s._v("编辑"),a("code",[s._v("msa/tb/docker-postgre")]),s._v("文件夹下"),a("code",[s._v("logback.xml")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DOCTYPE")]),s._v(" configuration"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("configuration scan"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v(" scanPeriod"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10 seconds"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("appender name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fileLogAppender"')]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ch.qos.logback.core.rolling.RollingFileAppender"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("thingsboard"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("thingsboard"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("rollingPolicy\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("fileNamePattern"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("thingsboard"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("thingsboard"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("%d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("yyyy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MM")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("%i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("fileNamePattern"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("maxFileSize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MB")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("maxFileSize"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("maxHistory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("maxHistory"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("totalSizeCap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GB")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("totalSizeCap"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("rollingPolicy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("encoder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("pattern"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ISO8601")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("thread"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5l")]),s._v("evel "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pattern"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("encoder"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("appender"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("appender name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"STDOUT"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ch.qos.logback.core.ConsoleAppender"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("encoder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("pattern"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ISO8601")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("thread"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5l")]),s._v("evel "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pattern"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("encoder"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("appender"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("logger name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"org.thingsboard.server"')]),s._v(" level"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"INFO"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("logger name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"com.microsoft.azure.servicebus.primitives.CoreMessageReceiver"')]),s._v(" level"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OFF"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("root level"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"INFO"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("appender"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ref ref"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fileLogAppender"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("appender"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ref ref"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"STDOUT"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("configuration"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ENV")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SPRING_JPA_DATABASE_PLATFORM")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hibernate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dialect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("PostgreSQLDialect")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ENV")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SPRING_DRIVER_CLASS_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("postgresql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("Driver")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ENV")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SPRING_DATASOURCE_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("jdbc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("postgresql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".9")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".31")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5432")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("thingsboard\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ENV")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SPRING_DATASOURCE_USERNAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("pkg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ENV")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SPRING_DATASOURCE_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br")])]),a("p",[a("img",{attrs:{src:"/Users/izhaong/izhaong/Blog/izhaong.com-localFile/020150.%E5%BC%80%E6%BA%90%E7%9A%84%E7%89%A9%E8%81%94%E7%BD%91%E5%B9%B3%E5%8F%B0thingsboard%E9%83%A8%E7%BD%B2/1602310699264-bd27d149-f73a-4fc3-a7d3-eea69e9d738b.png",alt:"img"}})]),s._v(" "),a("ul",[a("li",[a("em",[s._v("远程地址")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/izhaong/izhaong.com-oss/blogImg/020150.%E5%BC%80%E6%BA%90%E7%9A%84%E7%89%A9%E8%81%94%E7%BD%91%E5%B9%B3%E5%8F%B0thingsboard%E9%83%A8%E7%BD%B2/2021/12/30/13-37-04-a30d86b2d6faa764af5111f8b87e8cdc-1602311262218-ff0d397d-3c9f-439c-a0e7-f12c0c09f0be-538aec.png",alt:"img"}})]),s._v(" "),a("ul",[a("li",[a("em",[s._v("镜像")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/izhaong/izhaong.com-oss/blogImg/020150.%E5%BC%80%E6%BA%90%E7%9A%84%E7%89%A9%E8%81%94%E7%BD%91%E5%B9%B3%E5%8F%B0thingsboard%E9%83%A8%E7%BD%B2/2021/12/30/13-37-08-2d53da26eef36594fee2e18495751a9b-1602311418694-f27adc6a-3d29-4cbb-a919-75b490833aed-c4cf43.png",alt:"img"}})]),s._v(" "),a("ul",[a("li",[s._v("最后"),a("code",[s._v("shift+f10")]),s._v(" run 下docker")])]),s._v(" "),a("h2",{attrs:{id:"遇到的错误处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#遇到的错误处理"}},[s._v("#")]),s._v(" 遇到的错误处理")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("chmod: changing permissions of ‘/var/lib/postgresql/data’: Permission denied")])]),s._v(" "),a("li",[a("ul",[a("li",[s._v("发现此内容可解决chmod问题："),a("a",{attrs:{href:"http://stackoverflow.com/questions/24288616/permission-denied-on-accessing-host-directory-in-docker",target:"_blank",rel:"noopener noreferrer"}},[s._v("http"),a("OutboundLink")],1),s._v(" :")])])])]),s._v(" "),a("p",[a("a",{attrs:{href:"http://stackoverflow.com/questions/24288616/permission-denied-on-accessing-host-directory-in-docker",target:"_blank",rel:"noopener noreferrer"}},[s._v("//stackoverflow.com/questions/24288616/permission-denied-on-accessing-host-directory-in-docker"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("也可以在此处查看selinux安全问题："),a("a",{attrs:{href:"https://docs.docker.com/engine/tutorials/dockervolumes/#/volume-labels",target:"_blank",rel:"noopener noreferrer"}},[s._v("https"),a("OutboundLink")],1),s._v(" :")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://docs.docker.com/engine/tutorials/dockervolumes/#/volume-labels",target:"_blank",rel:"noopener noreferrer"}},[s._v("//docs.docker.com/engine/tutorials/dockervolumes/#/volume-labels"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("我通过在volume命令末尾添加：z修复了docker-compose文件")]),s._v(" "),a("p",[s._v("volumes: - /media/dataDemo/db:/var/lib/postgresql/data:z")]),s._v(" "),a("p",[s._v("volumes: :Z的含义")]),s._v(" "),a("p",[s._v("docker-compose.yml举例：")]),s._v(" "),a("p",[s._v("volumes:")]),s._v(" "),a("p",[s._v("- /mnt/db:/var/lib/db:Z")]),s._v(" "),a("p",[s._v("如果宿主机开启了SELinux，如果不加“:Z”，会报错权限不足：Permission denied。")]),s._v(" "),a("p",[s._v("这涉及到label权限的问题。")]),s._v(" "),a("p",[s._v("默认情况下docker会打上label: svirt_sandbox_file_t。")]),s._v(" "),a("p",[s._v("宿主机上需要mount的目录，此时需要打上同样的label：")]),s._v(" "),a("p",[s._v("使用:z相当于执行语句：")]),s._v(" "),a("p",[s._v("chcon -Rt svirt_sandbox_file_t /var/db")]),s._v(" "),a("p",[s._v("使用:Z相当于宿主机打上了docker里的所有label。")]),s._v(" "),a("p",[s._v("参考：")]),s._v(" "),a("p",[s._v("http://www.projectatomic.io/blog/2015/06/using-volumes-with-docker-can-cause-problems-with-selinux/")]),s._v(" "),a("ul",[a("li",[s._v("Caused by: java.net.SocketTimeoutException: connect timed out")])]),s._v(" "),a("p",[s._v("配置远程连接")]),s._v(" "),a("ul",[a("li",[s._v("docker Failed to restart docker.service: Unit not found.")])]),s._v(" "),a("p",[s._v("新版本需要docker.socket")]),s._v(" "),a("ul",[a("li",[a("ul",[a("li",[s._v("卸载docker，再重新安装，即可出现docker.socket")]),s._v(" "),a("li",[s._v("创建一个/usr/lib/systemd/system/docker.socket文件，然后systemctl daemon-reload，最后systemctl start docker.service，即可启动成功。")])])]),s._v(" "),a("li",[a("p",[s._v("ERROR: for timescaledb  Cannot start service timescaledb: Unknown runtime specified docker-runc")])])]),s._v(" "),a("p",[s._v("​    ERROR: Encountered errors while bringing up the project.")]),s._v(" "),a("ul",[a("li",[a("ul",[a("li",[s._v("关闭前停止容器")])])]),s._v(" "),a("li",[a("p",[s._v("driver failed programming external connectivity on endpoint")])]),s._v(" "),a("li",[a("ul",[a("li",[s._v("docker服务启动时定义的自定义链DOCKER由于 centos7 firewall 被清掉, firewall的底层是使用iptables进行数据过滤，建立在iptables之上，这可能会与 Docker 产生冲突。当 "),a("code",[s._v("firewalld")]),s._v(" 启动或者重启的时候，将会从 iptables 中移除 "),a("code",[s._v("DOCKER")]),s._v(" 的规则，从而影响了 Docker 的正常工作。当你使用的是 Systemd 的时候， "),a("code",[s._v("firewalld")]),s._v(" 会在 Docker 之前启动，但是如果你在 Docker 启动之后再启动 或者重启 "),a("code",[s._v("firewalld")]),s._v(" ，你就需要重启 Docker 进程了。重启docker服务及可重新生成自定义链DOCKER")])])])])])}),[],!1,null,null,null);a.default=r.exports}}]);