(window.webpackJsonp=window.webpackJsonp||[]).push([[282],{621:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[s._v("#")])]),s._v(" "),a("p",[s._v("之前一直用的是三方穿透服务natapp免费穿透")]),s._v(" "),a("p",[s._v("https://natapp.cn/")]),s._v(" "),a("h4",{attrs:{id:"缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[s._v("#")]),s._v(" 缺点")]),s._v(" "),a("ul",[a("li",[s._v("不定时强制更换域名/端口")]),s._v(" "),a("li",[s._v("服务不稳定")]),s._v(" "),a("li",[s._v("中转速度相当有限")])]),s._v(" "),a("p",[s._v("就在想着用自己的公网服务器搭建 更为可控一个 很稳定 类似natapp的穿透服务")]),s._v(" "),a("p",[s._v("一下记录 基于frp与zerotier moon服务器 的使用")]),s._v(" "),a("ul",[a("li",[s._v("一台公网服务器")]),s._v(" "),a("li",[s._v("docker")])]),s._v(" "),a("p",[s._v("https://hub.docker.com/r/snowdreamtech/frpc")]),s._v(" "),a("h3",{attrs:{id:"服务器搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器搭建"}},[s._v("#")]),s._v(" 服务器搭建")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://gitee.com/spoto/natserver#%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAfrps",target:"_blank",rel:"noopener noreferrer"}},[s._v("自建内网穿透服务器"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("创建初始化文件,   文件位置： "),a("code",[s._v("/izhaong/frp")])]),s._v(" "),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("common")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("bind_port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("7000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 面板端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("dashboard_port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("7500")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录面板账号设置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("dashboard_user")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("******")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("dashboard_pwd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("******")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置http及https协议下代理端口（非重要）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("vhost_http_port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("7080")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("vhost_https_port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("7081")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 身份验证")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("token")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1234")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("docker 命令 创建frp容器")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#服务器镜像：snowdreamtech/frps")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启：always")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#网络模式：host")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件映射：/izhaong/frp/frps.ini:/etc/frp/frps.ini   // 本地:容器位置")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /izhaong/frp/frps.ini:/etc/frp/frps.ini "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" frps snowdreamtech/frps\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/izhaong/izhaong.com-oss/blogImg/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%20%E5%9F%BA%E4%BA%8Efrp%E4%B8%8Ezerotier%20moon%E6%9C%8D%E5%8A%A1%E5%99%A8/2022/06/20/11-03-15-aad5b86ae8531d49a0cf72b8f4927d96-image-20220619113333032-51a2fe.png",alt:"image-20220619113333032"}})]),s._v(" "),a("p",[s._v("因为是一个host模式， 现在是可以在在公网上访问端口了，注意你的服务器防火墙")]),s._v(" "),a("h3",{attrs:{id:"客户端搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端搭建"}},[s._v("#")]),s._v(" 客户端搭建")]),s._v(" "),a("ul",[a("li",[s._v("在本级上开启一个8080的服务")]),s._v(" "),a("li",[s._v("配置frpc.ini 文件")])]),s._v(" "),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("common")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# server_addr为FRPS服务器IP地址")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server_addr")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("** // 你线上服务器地址如：121.41.41.41")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# server_port为服务端监听端口，bind_port")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("server_port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("7000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 身份验证")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("token")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1234 // 跟上面一样")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token section"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("web_dev_8080")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("tcp")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("local_ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("127.0.0.1 // docker可能会有网络隔离 可以填写ip地址：192.168.31.163")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("local_port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("8080")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("remote_port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("28080")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# [ssh] 为服务名称，下方此处设置为，访问frp服务段的2288端口时，等同于通过中转服务器访问127.0.0.1的22端口。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type 为连接的类型，此处为tcp")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# local_ip 为中转客户端实际访问的IP ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# local_port 为目标端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# remote_port 为远程端口")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 桌面连接")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# [desk_6580]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type = tcp")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# local_ip = 192.168.1.229")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# local_port = 6580")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# remote_port = 16580")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("h4",{attrs:{id:"客户端容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端容器"}},[s._v("#")]),s._v(" 客户端容器")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /Users/izhaong/izhaong/Docker_K8s/frp/frpc.ini:/etc/frp/frpc.ini "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" frpc snowdreamtech/frpc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[s._v("#")]),s._v(" 问题")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/06/19 06:00:09 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("E"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("proxy.go:796"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ac8fcbae50e11478"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web_server_8080"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" connect to "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:8080"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" error: dial tcp "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:8080: connect: connection refused\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("docker容器之间是互相隔离的，不能互相访问,解决掉就好了")])])}),[],!1,null,null,null);a.default=e.exports}}]);