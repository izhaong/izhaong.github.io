(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{372:function(s,a,t){"use strict";t.r(a);var e=t(4),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"最终效果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最终效果"}},[s._v("#")]),s._v(" 最终效果")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/izhaong/izhaong.com-oss/blogImg/012010./2021/12/24/18-04-03-582c92fef9a63d6287f1adb5d1c74c6a-1607916733899-2650e9cd-72aa-470e-aa2b-498bfb4adcb1-0c6c0b.png",alt:"img"}})]),s._v(" "),a("p",[a("em",[s._v("开始了~")])]),s._v(" "),a("h2",{attrs:{id:"私网映射为公网"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#私网映射为公网"}},[s._v("#")]),s._v(" 私网映射为公网")]),s._v(" "),a("ul",[a("li",[s._v("如果你需要非局域网内访问就需要做这一步")]),s._v(" "),a("li",[s._v("映射好公网后 ip 可能会变动 建议用域名做动态映射")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/izhaong/izhaong.com-oss/blogImg/012010./2022/05/15/22-01-38-9a1239d49f6820a64363726cf0a2842a-1607913390851-87025413-9540-4311-aba9-3751c62aeb91-63c182.png",alt:"img"}})]),s._v(" "),a("h2",{attrs:{id:"搭建转流服务器-rtsp-rtmp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#搭建转流服务器-rtsp-rtmp"}},[s._v("#")]),s._v(" 搭建转流服务器(RTSP => RTMP)")]),s._v(" "),a("ul",[a("li",[s._v("可参考其他方法")])]),s._v(" "),a("p",[a("a",{attrs:{href:"https://blog.csdn.net/u012492535/article/details/79220398",target:"_blank",rel:"noopener noreferrer"}},[s._v("通过FFmpeg将rtsp流摄像头视频转码为rtmp播放"),a("OutboundLink")],1),s._v(" https://blog.csdn.net/u012492535/article/details/79220398")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("我用的现成的"),a("code",[s._v("docker")]),s._v("镜像部署的服务 原理一样的")])]),s._v(" "),a("li",[a("ul",[a("li",[s._v("GitHub地址: https://github.com/ossrs/srs")]),s._v(" "),a("li",[s._v("搭建好后就可以通过服务器地址:8380默认端口 查看了")])])]),s._v(" "),a("li",[a("ul",[a("li",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/izhaong/izhaong.com-oss/blogImg/abnerworks.Typora/2021/12/24/18-05-45-aacb015387d441e46b225d6e028e41ae-18-04-56-aacb015387d441e46b225d6e028e41ae-1607916374134-85577282-4cc9-4b57-a4fd-acb7c6334b35-bec2f8-86a58a.png",alt:"img"}})])])])]),s._v(" "),a("h2",{attrs:{id:"服务端相关命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务端相关命令"}},[s._v("#")]),s._v(" 服务端相关命令")]),s._v(" "),a("h3",{attrs:{id:"添加视频流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加视频流"}},[s._v("#")]),s._v(" 添加视频流")]),s._v(" "),a("p",[a("strong",[s._v("直播")])]),s._v(" "),a("ul",[a("li",[s._v("在容器外执行srs容器内的命令")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker exec -it ${你的srs容器地址} /bin/bash -c ffmpeg -rtsp_transport tcp -i rtsp://${账号:密码}@${映射为公网的ip或者域名地址ztzyjc.3322.org}:${端口 默认9002}/Streaming/channels/${你的摄像头通道地址}0${主流1 子流2}  -c:v libx264 -crf 300 -acodec aac -f flv rtmp://127.0.0.1:1935/live/mystream${地址要不一样的, 我的是通道地址}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("以我的地址为例: 在9.20的服务器上部署的srs 命令为")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker exec e5e1135e7cf6 /bin/bash -c 'ffmpeg -rtsp_transport tcp -i rtsp://admin:******@www.***.com:9002/Streaming/channels/2001  -c:v libx264  -acodec aac -f flv rtmp://127.0.0.1:1935/live/mystream20'\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("这样前端就能通过地址"),a("code",[s._v("rtmp://192.168.9.20:8380/live/mystream20")]),s._v(" 或者 "),a("code",[s._v("http://192.168.9.20:8380/live/mystream20")])])]),s._v(" "),a("p",[a("strong",[s._v("回放")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("命令"),a("code",[s._v("docker exec e5e1135e7cf6 /bin/bash -c 'ffmpeg -rtsp_transport tcp -i \"rtsp://admin:******@www.***.com:9002/Streaming/tracks/2001?starttime=20201214t000000z&endtime=20201214t000000z\" -c copy -f flv rtmp://127.0.0.1:1935/live/mytrack20201214t000000z'")])])]),s._v(" "),a("li",[a("ul",[a("li",[s._v("相应的前端播放地址: "),a("code",[s._v("http://192.168.9.20:8380/live/mytrack20201214t000000z")])])])])]),s._v(" "),a("h2",{attrs:{id:"前端对接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端对接"}},[s._v("#")]),s._v(" 前端对接")]),s._v(" "),a("h3",{attrs:{id:"说明事项-最终转流为flv格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#说明事项-最终转流为flv格式"}},[s._v("#")]),s._v(" 说明事项(最终转流为flv格式)")]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[s._v("RTMP")]),s._v(" "),a("strong",[s._v("需要 flash 插件播放(以下有说明)")]),s._v(", chrome 在2020年12月后已经不再支持, 现在相关api接口都已经关闭了, 需要操作flash本身去调用浏览器相关接口(放弃了)")])]),s._v(" "),a("li",[a("ul",[a("li",[s._v("https://segmentfault.com/a/1190000018582436")]),s._v(" "),a("li",[s._v("RTMP(Real Time Messaging Protocol)实时消息传送协议是Adobe Systems公司为Flash播放器和服务器之间音频、视频和数据传输开发的私有协议。")])])]),s._v(" "),a("li",[a("ul",[a("li",[s._v("RTMP是一个应用层协议，有多路复用的特点，传输内容有视频、音频、控制命令")]),s._v(" "),a("li",[s._v("RTMP 在音视频相关的协议中，它的突出特点是：连接可靠、低延时")])])]),s._v(" "),a("li",[a("p",[s._v("使用flv")])]),s._v(" "),a("li",[a("ul",[a("li",[s._v("视频加载快比hls的m3u8格式快得多(可能是个人情况,未作深究)")])])]),s._v(" "),a("li",[a("p",[s._v("前端添加设备需要写服务端cmd脚本, 我这边也是使用的 nodejs 的express搭建了权限校验和docker的添加视频流命令")])]),s._v(" "),a("li",[a("ul",[a("li",[s._v("附上地址: https://gitee.com/Izhaong/node-srs-cmd")])])])]),s._v(" "),a("h3",{attrs:{id:"vue-接入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue-接入"}},[s._v("#")]),s._v(" Vue 接入")]),s._v(" "),a("p",[a("strong",[s._v("我使用了")]),s._v(" "),a("code",[s._v("**Dplayer**")]),a("strong",[s._v("播放器,")]),s._v(" 附上链接: http://dplayer.js.org/zh/guide.html#flv")]),s._v(" "),a("ol",[a("li",[a("p",[a("code",[s._v("public/index.js")]),s._v("引入"),a("code",[s._v('<script src="https://cdn.bootcdn.net/ajax/libs/flv.js/1.5.0/flv.min.js"><\/script>')])])]),s._v(" "),a("li",[a("ol",[a("li",[s._v("可以使用其他的cdn")])])]),s._v(" "),a("li",[a("p",[s._v("cmd 运行"),a("code",[s._v("cnpm i dplayer -S")])])]),s._v(" "),a("li",[a("p",[s._v("视频加载页面(单个视频)")])])]),s._v(" "),a("div",{staticClass:"language-vue line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vue"}},[a("code",[s._v("...\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("div")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("dplayer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n...\n\nimport DPlayer from 'dplayer'\n\ndata: { dp: undefined }\nmounted() { this.initPlayer() }\nmethods: {\n\tinitPlayer() {\n\t\tthis.$nextTick(() => {\n        const liveBaseUrl = 'http://192.168.9.20:8380' // 你的srs服务地址\n        // const url = live ? `${liveBaseUrl}/live/mystream${channelNo}.flv` : `${liveBaseUrl}/live/mytrack${this.datetimeValue[0]}.flv` // 回放后面再说\n        const url = `${liveBaseUrl}/live/mystream${channelNo}.flv` // 直播地址\n        // 测试flx地址: https://sf1-hscdn-tos.pstatp.com/obj/media-fe/xgplayer_doc_video/flv/xgplayer-demo-360p.flv\n        this.dp = new DPlayer({\n          container: document.getElementById('dplayer'),\n          video: {\n            url,\n            type: 'flv'\n          },\n          // mutex: false, // api自己查查 不描述了 \n          autoplay: true,\n          live\n        })\n      })\n  }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("p",[s._v("a. 多个视频自己琢磨吧~我给个大概思路, 数组嘛~简单 如下循环就好了")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/izhaong/izhaong.com-oss/blogImg/abnerworks.Typora/2021/12/24/18-05-54-224aaac6189cd90c2f64c89f27fe980f-18-05-06-224aaac6189cd90c2f64c89f27fe980f-1607915827688-dbc24549-742d-4b82-8e8d-8bee8ae07de4-fe1058-63a239.png",alt:"img"}})]),s._v(" "),a("p",[a("em",[s._v("到此应该就差不多了, 肯定还有很多遗漏 不想写了 累~")])])])}),[],!1,null,null,null);a.default=n.exports}}]);