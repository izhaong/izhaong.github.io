(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{459:function(e,s,a){"use strict";a.r(s);var t=a(21),r=Object(t.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"sequelize"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sequelize"}},[e._v("#")]),e._v(" Sequelize")]),e._v(" "),a("h3",{attrs:{id:"sequelize-cli"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sequelize-cli"}},[e._v("#")]),e._v(" sequelize-cli")]),e._v(" "),a("p",[a("strong",[e._v("需要 "),a("strong",[a("a",{attrs:{href:"http://docs.sequelizejs.com/manual/tutorial/migrations.html",target:"_blank",rel:"noopener noreferrer"}},[a("strong",[e._v("Migrations")]),a("OutboundLink")],1)]),e._v(" 来帮我们管理数据结构的变更")]),e._v("(在项目的演进过程中，每一个迭代都有可能对数据库数据结构做变更，怎样跟踪每一个迭代的数据变更，并在不同的环境（开发、测试、CI）和迭代切换中，快速变更数据结构呢？)\nsequelize 提供了 "),a("a",{attrs:{href:"https://github.com/sequelize/cli",target:"_blank",rel:"noopener noreferrer"}},[e._v("sequelize-cli"),a("OutboundLink")],1),e._v(" 工具来实现 "),a("a",{attrs:{href:"http://docs.sequelizejs.com/manual/tutorial/migrations.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Migrations"),a("OutboundLink")],1)]),e._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[e._v("sequelize "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("command"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n\nCommands"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("\n  sequelize db"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("migrate                        Run pending migrations\n  sequelize db"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("migrate"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("schema"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("timestamps"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("add  Update migration table to have timestamps\n  sequelize db"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("migrate"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("status                 List the status "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("of")]),e._v(" all migrations\n  sequelize db"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("migrate"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("undo                   Reverts a migration\n  sequelize db"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("migrate"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("undo"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("all               Revert all migrations ran\n  sequelize db"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("seed                           Run specified seeder\n  sequelize db"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("seed"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("undo                      Deletes data from the database\n  sequelize db"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("seed"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("all                       Run every seeder\n  sequelize db"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("seed"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("undo"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("all                  Deletes data from the database\n  sequelize db"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("create                         Create database specified by configuration\n  sequelize db"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("drop                           Drop database specified by configuration\n  sequelize init                              Initializes project\n  sequelize init"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("config                       Initializes configuration\n  sequelize init"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("migrations                   Initializes migrations\n  sequelize init"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("models                       Initializes models\n  sequelize init"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("seeders                      Initializes seeders\n  sequelize migration"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("generate                Generates a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("migration")]),e._v(" file      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("aliases"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" migration"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("create"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n  sequelize model"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("generate                    Generates a model and its migration "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("aliases"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" model"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("create"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n  sequelize seed"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("generate                     Generates a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("seed")]),e._v(" file           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("aliases"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" seed"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("create"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n\nOptions"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("--")]),e._v("version  Show version number                                                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("boolean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("--")]),e._v("help     Show help                                                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("boolean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n\nPlease specify a command\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br"),a("span",{staticClass:"line-number"},[e._v("25")]),a("br"),a("span",{staticClass:"line-number"},[e._v("26")]),a("br"),a("span",{staticClass:"line-number"},[e._v("27")]),a("br"),a("span",{staticClass:"line-number"},[e._v("28")]),a("br")])]),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[e._v("# 升级数据库\nnpx sequelize db"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("migrate\n# 如果有问题需要回滚，可以通过 "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[e._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("db:migrate:undo")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[e._v("`")])]),e._v(" 回退一个变更\n# npx sequelize db"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("migrate"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("undo\n# 可以通过 "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[e._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("db:migrate:undo:all")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[e._v("`")])]),e._v(" 回退到初始状态\n# npx sequelize db"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("migrate"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("undo"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v("all\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])]),a("h2",{attrs:{id:"错误处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误处理"}},[e._v("#")]),e._v(" 错误处理")]),e._v(" "),a("ul",[a("li",[e._v("2020-10-23 15:20:10,104 "),a("strong",[e._v("ERROR")]),e._v(" 124768 [-/127.0.0.1/-/8ms POST /api/v1/video] nodejs.SequelizeDatabaseError: Incorrect string value: '\\xE5\\x8F\\x8D\\xE5\\xAF\\xB9...' for column 'introduce' at row 1")])]),e._v(" "),a("p",[e._v('_    at Query.formatError (D:\\Code\\Work\\wxwl-resource-share\\node_modules_sequelize@6.3.5@sequelize\\lib\\dialects\\mysql\\query.js:239:16)_\n_    at Query.run (D:\\Code\\Work\\wxwl-resource-share\\node_modules_sequelize@6.3.5@sequelize\\lib\\dialects\\mysql\\query.js:54:18)_\n_    at processTicksAndRejections (internal/process/task_queues.js:97:5)_\nname: "SequelizeDatabaseError"\nparent: {"code":"ER_TRUNCATED_WRONG_VALUE_FOR_FIELD","errno":1366,"sqlState":"HY000","sqlMessage":"Incorrect string value: \'\\xE5\\x8F\\x8D\\xE5\\xAF\\xB9...\' for column \'introduce\' at row 1","sql":"INSERT INTO '),a("code",[e._v("videos")]),e._v(" ("),a("code",[e._v("id")]),e._v(","),a("code",[e._v("category_id")]),e._v(","),a("code",[e._v("title")]),e._v(","),a("code",[e._v("introduce")]),e._v(","),a("code",[e._v("detail")]),e._v(","),a("code",[e._v("create_date")]),e._v(') VALUES (DEFAULT,?,?,?,?,?);","parameters":[1,"test11","tess反对t","231231","2020-10-23 07:20:10"]}\noriginal: {"code":"ER_TRUNCATED_WRONG_VALUE_FOR_FIELD","errno":1366,"sqlState":"HY000","sqlMessage":"Incorrect string value: \'\\xE5\\x8F\\x8D\\xE5\\xAF\\xB9...\' for column \'introduce\' at row 1","sql":"INSERT INTO '),a("code",[e._v("videos")]),e._v(" ("),a("code",[e._v("id")]),e._v(","),a("code",[e._v("category_id")]),e._v(","),a("code",[e._v("title")]),e._v(","),a("code",[e._v("introduce")]),e._v(","),a("code",[e._v("detail")]),e._v(","),a("code",[e._v("create_date")]),e._v(') VALUES (DEFAULT,?,?,?,?,?);","parameters":[1,"test11","tess反对t","231231","2020-10-23 07:20:10"]}\nsql: "INSERT INTO '),a("code",[e._v("videos")]),e._v(" ("),a("code",[e._v("id")]),e._v(","),a("code",[e._v("category_id")]),e._v(","),a("code",[e._v("title")]),e._v(","),a("code",[e._v("introduce")]),e._v(","),a("code",[e._v("detail")]),e._v(","),a("code",[e._v("create_date")]),e._v(') VALUES (DEFAULT,?,?,?,?,?);"\nparameters: [1,"test11","tess反对t","231231","2020-10-23 07:20:10"]\npid: 124768\nhostname: DESKTOP-FUCU627')])])}),[],!1,null,null,null);s.default=r.exports}}]);